<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <title>Slides 3D + ScrollTrigger + ScrollSmoother</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- GSAP + Plugins -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollSmoother.min.js"></script>
    
    <style>
        /* CSS ESSENCIAL PARA O CARROSSEL 3D */
        html, body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        #smooth-wrapper {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        
        #smooth-content {
            will-change: transform;
        }
        
        #slides-wrapper {
            width: 400vw; /* 4 slides x 100vw cada */
            --rotate-x: 0;
            --rotate-y: 0;
            --translate-y: 0;
        }
        
        .slide {
            width: 100vw;
            height: 100vh;
            transform: translateX(var(--slide-x, 0)) 
                       rotateX(var(--rotate-x)) 
                       rotateY(var(--rotate-y)) 
                       translateY(var(--translate-y));
            transform-style: preserve-3d;
            -webkit-transform-style: preserve-3d;
            transition: transform 0.1s linear;
        }
        
        .slide-content {
            transform: translateZ(50px);
            transform-style: preserve-3d;
            -webkit-transform-style: preserve-3d;
        }
    </style>
</head>

<body class="bg-gray-900 text-white">

    <div id="smooth-wrapper">
        <div id="smooth-content">

            <section class="h-screen flex items-center justify-center bg-gray-900">
                <h1 class="text-4xl font-bold">Role para ver os slides 3D ‚û°Ô∏è</h1>
            </section>

            <!-- Container dos slides -->
            <section id="slides-container"
                class="relative h-screen overflow-hidden bg-gradient-to-b from-gray-800 to-gray-900">
                <div id="slides-wrapper" class="flex flex-row">
                    <div class="slide flex flex-none items-center justify-center bg-green-500 text-3xl font-bold">
                        <div class="slide-content">Slide 1</div>
                    </div>
                    <div class="slide flex flex-none items-center justify-center bg-blue-500 text-3xl font-bold">
                        <div class="slide-content">Slide 2</div>
                    </div>
                    <div class="slide flex flex-none items-center justify-center bg-pink-500 text-3xl font-bold">
                        <div class="slide-content">Slide 3</div>
                    </div>
                    <div class="slide flex flex-none items-center justify-center bg-yellow-400 text-3xl font-bold text-gray-900">
                        <div class="slide-content">Slide 4</div>
                    </div>
                </div>
            </section>

            <section class="h-screen flex items-center justify-center bg-gray-900">
                <h2 class="text-3xl">Fim üé¨</h2>
            </section>

        </div>
    </div>

    <script>
        // Registrar TODOS os plugins GSAP
        gsap.registerPlugin(ScrollTrigger, ScrollSmoother);

        // Criar ScrollSmoother
        ScrollSmoother.create({
            wrapper: "#smooth-wrapper",
            content: "#smooth-content",
            smooth: 1.3,
            effects: true,
            normalizeScroll: true
        });

        // Configurar anima√ß√£o do carrossel
        const slidesWrapper = document.querySelector("#slides-wrapper");
        const slides = gsap.utils.toArray(".slide");
        const container = document.querySelector("#slides-container");

        // Configurar posi√ß√£o inicial dos slides
        gsap.set(slidesWrapper, {
            xPercent: 0
        });

        // Anima√ß√£o principal do carrossel
        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: container,
                start: "top top",
                end: "+=4500",
                scrub: true,
                pin: true,
                anticipatePin: 1,
                markers: true // Desative em produ√ß√£o
            }
        });

        // Mover slides horizontalmente
        tl.to(slidesWrapper, {
            xPercent: -100 * (slides.length - 1),
            ease: "none"
        });

        // SISTEMA DE EFEITO 3D COM MOUSE - CORRIGIDO
        let mouseTween;
        let mouseEnabled = true;
        let lastMouseTime = 0;
        const MOUSE_THROTTLE = 16; // ~60fps

        // Controle de estado para prevenir conflitos
        ScrollTrigger.addEventListener('scrollStart', () => {
            mouseEnabled = false;
            // Limpar transforma√ß√µes do mouse durante scroll
            if (mouseTween) mouseTween.kill();
            gsap.to(slides, {
                '--rotate-x': 0,
                '--rotate-y': 0,
                '--translate-y': 0,
                duration: 0.3,
                ease: "power2.out"
            });
        });

        ScrollTrigger.addEventListener('scrollEnd', () => {
            setTimeout(() => {
                mouseEnabled = true;
            }, 300);
        });

        // Evento mousemove otimizado
        container.addEventListener("mousemove", (e) => {
            const now = Date.now();
            if (now - lastMouseTime < MOUSE_THROTTLE || !mouseEnabled) return;
            lastMouseTime = now;

            const rect = container.getBoundingClientRect();
            const scrollX = window.pageXOffset || document.documentElement.scrollLeft;
            const scrollY = window.pageYOffset || document.documentElement.scrollTop;
            
            // C√°lculo preciso da posi√ß√£o do mouse
            const cx = rect.left + scrollX + (rect.width / 2);
            const cy = rect.top + scrollY + (rect.height / 2);
            
            // Normalizar para -1 a 1
            const dx = (e.pageX - cx) / (rect.width / 2);
            const dy = (e.pageY - cy) / (rect.height / 2);

            // Suavizar valores extremos
            const smoothDx = Math.max(-1, Math.min(1, dx * 1.2));
            const smoothDy = Math.max(-1, Math.min(1, dy * 1.2));

            if (mouseTween && mouseTween.isActive()) {
                mouseTween.kill();
            }

            // Aplicar efeito 3D usando CSS variables
            mouseTween = gsap.to(slides, {
                '--rotate-x': -smoothDy * 8,  // Rota√ß√£o X baseada no movimento vertical
                '--rotate-y': smoothDx * 12,  // Rota√ß√£o Y baseada no movimento horizontal
                '--translate-y': smoothDy * 20, // Movimento vertical sutil
                duration: 0.8,
                ease: "power2.out",
                overwrite: "auto"
            });
        });

        // Reset suave ao sair do container
        container.addEventListener("mouseleave", () => {
            if (!mouseEnabled) return;
            
            if (mouseTween) mouseTween.kill();
            
            gsap.to(slides, {
                '--rotate-x': 0,
                '--rotate-y': 0,
                '--translate-y': 0,
                duration: 1.2,
                ease: "power3.out",
                overwrite: true
            });
        });

        // Prevenir comportamento padr√£o de arrastar
        container.addEventListener('dragstart', (e) => {
            e.preventDefault();
            return false;
        });

        // Debug info (remova em produ√ß√£o)
        console.log('üéØ Sistema 3D Carregado:', {
            totalSlides: slides.length,
            mouseEnabled: true,
            smootherActive: !!smoother
        });

    </script>
</body>
</html>
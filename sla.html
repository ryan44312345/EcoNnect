<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scroll Horizontal com Sobreposição</title>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      overflow-x: hidden;
    }

    .slide {
      will-change: clip-path;
    }
  </style>
</head>
<body>
  <!-- Wrapper fixo que contém os slides empilhados -->
  <div id="slides-wrapper" class="fixed top-0 left-0 w-screen h-screen overflow-hidden">
    <!-- Slide 1 -->
    <section class="slide absolute inset-0 flex items-center justify-center text-6xl font-bold text-white bg-rose-500">
      SLIDE 1
    </section>
    <!-- Slide 2 -->
    <section class="slide absolute inset-0 flex items-center justify-center text-6xl font-bold text-white bg-blue-600">
      SLIDE 2
    </section>
    <!-- Slide 3 -->
    <section class="slide absolute inset-0 flex items-center justify-center text-6xl font-bold text-white bg-emerald-500">
      SLIDE 3
    </section>
    <!-- Slide 4 -->
    <section class="slide absolute inset-0 flex items-center justify-center text-6xl font-bold text-white bg-indigo-600">
      SLIDE 4
    </section>
  </div>

  <!-- Spacer invisível que cria o espaço de scroll -->
  <div id="spacer"></div>

  <script>
    gsap.registerPlugin(ScrollTrigger);

    const slides = gsap.utils.toArray(".slide");
    const spacer = document.getElementById("spacer");

    function initScroll() {
      // Define a altura do spacer (cada slide = 100vh de scroll)
      const scrollHeight = slides.length * window.innerHeight;
      spacer.style.height = scrollHeight + "px";

      // Limpa scrollTriggers anteriores
      ScrollTrigger.getAll().forEach(t => t.kill());

      // Define z-index para slides posteriores ficarem acima
      slides.forEach((slide, i) => {
        slide.style.zIndex = i + 1;
      });

      // Primeiro slide já visível
      gsap.set(slides[0], { 
        clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)" 
      });

      // Anima os demais slides
      slides.forEach((slide, i) => {
        if (i === 0) return;

        // Estado inicial: fechado à direita
        gsap.set(slide, {
          clipPath: "polygon(100% 0%, 100% 0%, 100% 100%, 100% 100%)"
        });

        // Animação: cresce da direita para esquerda
        gsap.to(slide, {
          clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
          ease: "none",
          scrollTrigger: {
            trigger: spacer,
            start: () => `top+=${(i - 1) * window.innerHeight} top`,
            end: () => `top+=${i * window.innerHeight} top`,
            scrub: 1,
            invalidateOnRefresh: true,
            // markers: true // descomente para debug
          }
        });

        // Fade in suave
        gsap.fromTo(slide,
          { opacity: 0.95 },
          {
            opacity: 1,
            ease: "none",
            scrollTrigger: {
              trigger: spacer,
              start: () => `top+=${(i - 1) * window.innerHeight} top`,
              end: () => `top+=${i * window.innerHeight} top`,
              scrub: 1,
              invalidateOnRefresh: true
            }
          }
        );
      });
    }

    initScroll();
    
    // Reinicializa no resize
    window.addEventListener("resize", () => {
      initScroll();
    });
  </script>
</body>
</html>
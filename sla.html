<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Slides 3D + ScrollTrigger (+ ScrollSmoother fallback)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- GSAP core + plugins (ordem importa) -->
  <style>
      html,body { height:100%; }
      #slides-wrapper { perspective: 1000px; -webkit-perspective:1000px; }
    .slide { transform-style: preserve-3d; -webkit-transform-style: preserve-3d; }
    /* fallback visual para quando ScrollSmoother n√£o existir */
    .no-smoother body { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-gray-900 text-white">
    
  <div id="smooth-wrapper">
      <div id="smooth-content">

          <section class="h-screen flex items-center justify-center bg-gray-900">
        <h1 class="text-4xl font-bold">Role para ver os slides 3D ‚û°Ô∏è</h1>
      </section>
      
      <!-- wrapper de slides -->
      <section id="slides-wrapper" class="relative h-screen flex overflow-hidden bg-gradient-to-b from-gray-800 to-gray-900">
        <div class="slide w-full h-full flex items-center justify-center bg-green-500 text-3xl font-bold">Slide 1</div>
        <div class="slide w-full h-full flex items-center justify-center bg-blue-500 text-3xl font-bold">Slide 2</div>
        <div class="slide w-full h-full flex items-center justify-center bg-pink-500 text-3xl font-bold">Slide 3</div>
        <div class="slide w-full h-full flex items-center justify-center bg-yellow-400 text-3xl font-bold text-gray-900">Slide 4</div>
    </section>

      <section class="h-screen flex items-center justify-center bg-gray-900">
        <h2 class="text-3xl">Fim üé¨</h2>
      </section>
      
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollSmoother.min.js"></script>
<script>
    // registra plugins
    gsap.registerPlugin(ScrollTrigger);
    
    // tenta registrar ScrollSmoother se estiver carregado
    if (typeof ScrollSmoother !== "undefined") {
      gsap.registerPlugin(ScrollSmoother);
    } else {
      console.warn("ScrollSmoother n√£o definido ‚Äî usando fallback sem ScrollSmoother.");
      document.documentElement.classList.add("no-smoother");
    }

    // --- Cria ScrollSmoother se dispon√≠vel; sen√£o, deixa null e usa fallback ---
    let smoother = null;
    try {
      if (typeof ScrollSmoother !== "undefined") {
        smoother = ScrollSmoother.create({
          wrapper: "#smooth-wrapper",
          content: "#smooth-content",
          smooth: 1.3,
          effects: true
        });
      } else {
        // fallback leve: n√£o usa ScrollSmoother, mas ScrollTrigger continuar√° funcionando
        smoother = null;
      }
    } catch (err) {
      console.warn("Erro ao criar ScrollSmoother:", err);
      smoother = null;
    }

    // Seleciona slides
    const slides = gsap.utils.toArray(".slide");

    // Coloca slides lado a lado (cada slide 100% da viewport)
    slides.forEach((s, i) => {
      gsap.set(s, { xPercent: i * 100 });
    });

    // Calcula dura√ß√£o do scroll com base no n√∫mero de slides
    const totalPercent = 100 * (slides.length - 1);

    // Timeline que move os slides horizontalmente
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: "#slides-wrapper",
        // start/end: usamos fun√ß√µes para serem robustas com ou sem smoother
        start: "top top",
        end: () => `+=${slides.length * 100}%`,
        scrub: 1,
        pin: true,
        anticipatePin: 1,
        // markers: true, // descomente para depurar positions
      }
    });

    // anima os slides para a esquerda; xPercent negativo para revelar os seguintes
    tl.to(slides, {
      xPercent: -totalPercent, // equivalente a -100 * (slides.length - 1)
      ease: "none",
      // z animado pode dar sensa√ß√£o 3D; aqui apenas um leve ajuste
      onUpdate: () => { /* opcional: l√≥gica extra */ }
    });

    // PARALLAX MOUSE (aplica ao wrapper)
    const wrapper = document.querySelector("#slides-wrapper");
    let mouseTween;

    wrapper.addEventListener("mousemove", (e) => {
      const rect = wrapper.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      const dx = e.clientX - cx;
      const dy = e.clientY - cy;

      // kill tween anterior pra n√£o empilhar
      if (mouseTween) mouseTween.kill();

      // anima√ß√£o leve de parallax para cada slide (transform relativo)
      mouseTween = gsap.to(slides, {
        x: (i) => dx * 0.02,  // leve deslocamento horizontal acumulado
        y: (i) => dy * 0.01,  // leve deslocamento vertical
        rotationY: (i) => dx * 0.02,
        rotationX: (i) => -dy * 0.02,
        duration: 0.6,
        ease: "power2.out",
        overwrite: true
      });
    });

    wrapper.addEventListener("mouseleave", () => {
      if (mouseTween) mouseTween.kill();
      gsap.to(slides, { x: 0, y: 0, rotationX: 0, rotationY: 0, duration: 0.8, ease: "power2.out" });
    });

    // --- Dicas de debug caso ainda d√™ problema ---
    // 1) Abra o console (F12) e veja se h√° erro de carregamento dos .js (404).
    // 2) Se ScrollSmoother n√£o carregar, verifique se o arquivo est√° sendo bloqueado pela pol√≠tica do CDN/local.
    // 3) Ative markers no ScrollTrigger para inspecionar start/end/pin: adicione markers: true no config do scrollTrigger acima.
    // 4) Se usar bundler (Vite/Parcel), prefira importar via npm em vez de CDN.

    // opcional: ajustar comportamento caso queira usar factor -150 sugerido
    // ex: tl.to(slides, { xPercent: -150 * (slides.length - 1), ease: "none" });
  </script>
</body>
</html>
